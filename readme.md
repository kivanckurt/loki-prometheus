# Loki Logging Stack for Docker Swarm

This repository contains a lightweight, Swarm-native logging stack. It deploys **Grafana Loki** (log storage), **Promtail** (log collection agent running on every node), and **Grafana** (visualization), along with a sample log-producing application.

## üìÇ Project Structure

Ensure you have the following files in your directory before running the commands:

* `loki-stack.yml` (The Docker Stack definition)
* `promtail-config.yaml` (Configuration for the Promtail agent)

## üöÄ Quick Start

### 1. Initialize Docker Swarm

If your Docker host is not yet part of a Swarm, initialize it. If you are already running a Swarm, skip this step.

```bash
docker swarm init

```

### 2. Deploy the Stack

Deploy the services to the Swarm. This will create the overlay network and distribute the services (including the global Promtail agent) across your cluster.

```bash
docker stack deploy -c loki-stack.yml loki_stack

```

### 3. Verify Deployment

Wait a few moments for the images to pull and containers to start, then check the status of the services:

```bash
docker service ls

```

*Ensure that `loki_stack_loki`, `loki_stack_grafana`, and `loki_stack_promtail` show `1/1` (or matching replica counts).*

---

## ‚öôÔ∏è Grafana Configuration

Once the services are running, you need to connect Grafana to the Loki database.

### 1. Access Grafana

Open your web browser and navigate to:
`http://<YOUR_NODE_IP>:3000`

* **User:** `admin`
* **Password:** `admin`

*(You will be prompted to change the password upon first login; feel free to skip or change it.)*

### 2. Add Loki Data Source

1. In the left sidebar, go to **Connections** (or **Configuration** ‚öôÔ∏è) -> **Data Sources**.
2. Click the blue **+ Add new data source** button.
3. Select **Loki** from the list.
4. In the **HTTP** section, set the **URL** to:
```text
http://loki:3100

```


> **Note:** This URL uses the internal Docker Swarm service discovery name.


5. Scroll to the bottom and click **Save & Test**.
6. You should see a green message: * "Data source connected and labels found."*

---

## üîç Viewing Logs

1. Click the **Explore** icon (compass üß≠) in the left sidebar.
2. Ensure **Loki** is selected in the datasource dropdown at the top left.
3. **Filter by Service:**
* Click on the **Label filters** browser.
* Select `service_name`.
* Select `loki_stack_log-producer`.


4. Click the blue **Run query** button (top right).

You should now see the real-time logs generated by the sample application.

### Next Steps

Would you like me to create a script that automates the file creation and deployment steps for you?
